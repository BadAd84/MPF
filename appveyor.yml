# version format
version: 1.18-{build}

# pull request template
pull_requests:
  do_not_increment_build_number: true

# vm template
image: Visual Studio 2019

# environment variables
environment:
  EnableNuGetPackageRestore: true

# msbuild configuration
platform:
- Any CPU
configuration:
- Debug

# install dependencies
install:
- ps: appveyor DownloadFile https://dist.nuget.org/win-x86-commandline/latest/nuget.exe
- cd %APPVEYOR_BUILD_FOLDER%
- git submodule update --init --recursive

# pre-build script
before_build:
- nuget restore

# build step
build:
  verbosity: minimal
  project: DICUI.sln

# post-build step
after_build:
- ps: appveyor DownloadFile https://github.com/aaru-dps/Aaru/releases/download/v5.1.0.3214/aaru-5.1.0.3214-1_windows_x64.zip
- ps: appveyor DownloadFile http://www.chrysocome.net/downloads/8ab730cd2a29e76ddd89be1f99357942/dd-0.6beta3.zip
- ps: appveyor DownloadFile https://github.com/saramibreak/DiscImageCreator/files/5253259/DiscImageCreator_20200921.zip
- ps: appveyor DownloadFile https://archive.org/download/subdump_fua_0x28/subdump_fua_0x28.zip

- 7z e aaru-5.1.0.3214-1_windows_x64.zip -oDICUI\bin\Debug\net472\Programs\Aaru *
- 7z e aaru-5.1.0.3214-1_windows_x64.zip -oDICUI\bin\Debug\net48\Programs\Aaru *
- 7z e aaru-5.1.0.3214-1_windows_x64.zip -oDICUI\bin\Debug\netcoreapp3.1\Programs\Aaru *
- 7z e aaru-5.1.0.3214-1_windows_x64.zip -oDICUI.Avalonia\bin\Debug\net472\Programs\Aaru *
- 7z e aaru-5.1.0.3214-1_windows_x64.zip -oDICUI.Avalonia\bin\Debug\net48\Programs\Aaru *
- 7z e aaru-5.1.0.3214-1_windows_x64.zip -oDICUI.Avalonia\bin\Debug\netcoreapp3.1\Programs\Aaru *

- 7z e dd-0.6beta3.zip -oDICUI\bin\Debug\net472\Programs\DD *
- 7z e dd-0.6beta3.zip -oDICUI\bin\Debug\net48\Programs\DD *
- 7z e dd-0.6beta3.zip -oDICUI\bin\Debug\netcoreapp3.1\Programs\DD *
- 7z e dd-0.6beta3.zip -oDICUI.Avalonia\bin\Debug\net472\Programs\DD *
- 7z e dd-0.6beta3.zip -oDICUI.Avalonia\bin\Debug\net48\Programs\DD *
- 7z e dd-0.6beta3.zip -oDICUI.Avalonia\bin\Debug\netcoreapp3.1\Programs\DD *

- 7z e DiscImageCreator_20200921.zip -oDICUI\bin\Debug\net472\Programs\Creator Release_ANSI\*
- 7z e DiscImageCreator_20200921.zip -oDICUI\bin\Debug\net48\Programs\Creator Release_ANSI\*
- 7z e DiscImageCreator_20200921.zip -oDICUI\bin\Debug\netcoreapp3.1\Programs\Creator Release_ANSI\*
- 7z e DiscImageCreator_20200921.zip -oDICUI.Avalonia\bin\Debug\net472\Programs\Creator Release_ANSI\*
- 7z e DiscImageCreator_20200921.zip -oDICUI.Avalonia\bin\Debug\net48\Programs\Creator Release_ANSI\*
- 7z e DiscImageCreator_20200921.zip -oDICUI.Avalonia\bin\Debug\netcoreapp3.1\Programs\Creator Release_ANSI\*

- 7z e subdump_fua_0x28.zip -oDICUI\bin\Debug\net472 *
- mkdir DICUI\bin\Debug\net472\Programs\Subdump
- mv DICUI\bin\Debug\net472\subdump_fua_0x28.exe DICUI\bin\Debug\net472\Programs\Subdump\subdump.exe
- 7z e subdump_fua_0x28.zip -oDICUI\bin\Debug\net48 *
- mkdir DICUI\bin\Debug\net48\Programs\Subdump
- mv DICUI\bin\Debug\net48\subdump_fua_0x28.exe DICUI\bin\Debug\net48\Programs\Subdump\subdump.exe
- 7z e subdump_fua_0x28.zip -oDICUI\bin\Debug\netcoreapp3.1 *
- mkdir DICUI\bin\Debug\netcoreapp3.1\Programs\Subdump
- mv DICUI\bin\Debug\netcoreapp3.1\subdump_fua_0x28.exe DICUI\bin\Debug\netcoreapp3.1\Programs\Subdump\subdump.exe
- 7z e subdump_fua_0x28.zip -oDICUI.Avalonia\bin\Debug\net472 *
- mkdir DICUI.Avalonia\bin\Debug\net472\Programs\Subdump
- mv DICUI.Avalonia\bin\Debug\net472\subdump_fua_0x28.exe DICUI.Avalonia\bin\Debug\net472\Programs\Subdump\subdump.exe
- 7z e subdump_fua_0x28.zip -oDICUI.Avalonia\bin\Debug\net48 *
- mkdir DICUI.Avalonia\bin\Debug\net48\Programs\Subdump
- mv DICUI.Avalonia\bin\Debug\net48\subdump_fua_0x28.exe DICUI.Avalonia\bin\Debug\net48\Programs\Subdump\subdump.exe
- 7z e subdump_fua_0x28.zip -oDICUI.Avalonia\bin\Debug\netcoreapp3.1 *
- mkdir DICUI.Avalonia\bin\Debug\netcoreapp3.1\Programs\Subdump
- mv DICUI.Avalonia\bin\Debug\netcoreapp3.1\subdump_fua_0x28.exe DICUI.Avalonia\bin\Debug\netcoreapp3.1\Programs\Subdump\subdump.exe

- cd DICUI\bin\Debug
- 7z a DICUI_net472.zip net472\*
- 7z a DICUI_net48.zip net48\*
- 7z a DICUI_netcoreapp3.1.zip netcoreapp3.1\*

- cd ..\..\..\DICUI.Avalonia\bin\Debug
- 7z a DICUI-Avalonia_net472.zip net472\*
- 7z a DICUI-Avalonia_net48.zip net48\*
- 7z a DICUI-Avalonia_netcoreapp3.1.zip netcoreapp3.1\*

- cd ..\..\..\DICUI.Check\bin\Debug
- 7z a DICUI-Check_net472.zip net472\*
- 7z a DICUI-Check_net48.zip net48\*
- 7z a DICUI-Check_netcoreapp3.1.zip netcoreapp3.1\*

# artifact linking
artifacts:
- path: DICUI\bin\Debug\DICUI_net472.zip
  name: DICUI (WPF UI) (.NET Framework 4.7.2)
- path: DICUI\bin\Debug\DICUI_net48.zip
  name: DICUI (WPF UI) (.NET Framework 4.8)
- path: DICUI\bin\Debug\DICUI_netcoreapp3.1.zip
  name: DICUI (WPF UI) (.NET Core 3.1)

- path: DICUI.Avalonia\bin\Debug\DICUI-Avalonia_net472.zip
  name: DICUI (Avalonia UI) (.NET Framework 4.7.2)
- path: DICUI.Avalonia\bin\Debug\DICUI-Avalonia_net48.zip
  name: DICUI (Avalonia UI) (.NET Framework 4.8)
- path: DICUI.Avalonia\bin\Debug\DICUI-Avalonia_netcoreapp3.1.zip
  name: DICUI (Avalonia UI) (.NET Core 3.1)

- path: DICUI.Check\bin\Debug\DICUI-Check_net472.zip
  name: DICUI Check (.NET Framework 4.7.2)
- path: DICUI.Check\bin\Debug\DICUI-Check_net48.zip
  name: DICUI Check (.NET Framework 4.8)
- path: DICUI.Check\bin\Debug\DICUI-Check_netcoreapp3.1.zip
  name: DICUI Check (.NET Core 3.1)